{% extends 'application/base.html' %}
{% load i18n reference_extras staticfiles %}

{% block extrahead %}
<link rel="stylesheet" href="{% static 'application/css/blueimp-gallery.min.css' %}">
{% endblock %}

{% block content %}

    <div class="spacey">
    <div class="well well-sm well-info center">
        {% blocktrans with mail=applicant.user.email %}This string will have {{ mail }} inside.{% endblocktrans %}
    </div>
</div>

{% reference_table applicant references %}

<h2>{% trans 'Projects' %}</h2>

{% for group, grouped_references in references.iteritems %}
    <h3 id="{{ group.public_name }}">{{ group.name }}</h3>
    {{ group.description }}
    {% for reference in grouped_references %}
        <div id="{{ group.public_name }}-{{ reference.public_name }}" class="container spacey">

          <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title"><b>{{ reference.name }}</b></h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-3"><img data-src="holder.js/200x200" src="{{ reference.title_thumbnail.url }}" class="img-full" alt="Logo"/></div>
                        <div class="col-md-9">
                            {{ reference.description|safe }}
                            <br/><br/>
                            {% trans 'Attachments' %}
                            <ul>
                                {% for attachment in reference.attachment_set.all %}
                                    <li><a href="{{ attachment.file.url }}">{{ attachment.name }}</a> ({{ attachment.file.size|filesizeformat }})</li>
                                {% endfor %}
                            </ul>
                            <hr/>
                            {% trans 'Tags' %}<br/>
                            {% for weighted_tag in reference.weightedtag_set.all %}
                                <span class="label" style="background: {{ weighted_tag.tag.color }}">{{ weighted_tag.tag }}</span>
                            {% endfor %}<br/>
                            {% trans 'Technologies' %}<br/>
                            {% for tech in reference.technologies.all %}
                                {{ tech }}
                            {% endfor %}
                        </div>
                  </div>
                  <div class="row">
                            <div id="{{ reference.public_name }}-gallery" class="gallery spacey center">
                                {% for image in reference.images.all %}
                                <a href="{{ image.image.url }}" title="{{ image.title }}"><img src="{{ image.thumbnail.url }}" alt="{{ image.title }}"/></a>
                                {% endfor %}
                            </div>
                  </div>
                </div>
              </div>

        </div>
    {% endfor %}
{% endfor %}

<!-- The Gallery as lightbox dialog, should be a child element of the document body -->
<div id="blueimp-gallery" class="blueimp-gallery">
    <div class="slides"></div>
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close">×</a>
    <a class="play-pause"></a>
    <ol class="indicator"></ol>
</div>

{% endblock %}

{% block page_end %}

    <script src="{% static 'application/js/blueimp-gallery.min.js' %}"></script>
    <script>

	    var galleries = [
            {% for reference in references %}
                '{{ reference.public_name }}',
            {% endfor %}
		];

		for (var gal in galleries) {
			document.getElementById(galleries[gal]+'-gallery').onclick = function (event) {
			    event = event || window.event;
    			var target = event.target || event.srcElement,
        		    link = target.src ? target.parentNode : target,
        		    options = {index: link, event: event},
        		    links = this.getElementsByTagName('a');
    			blueimp.Gallery(links, options);
			};

		}

	</script>

{% endblock %}